(function(a,b){vrAdmin.Tour={disableForm:function(){b("form input").prop("disabled",true);b("form button").prop("disabled",true);b("body").addClass("loading")},enableForm:function(){b("form input").prop("disabled",false);b("form button").prop("disabled",false);b("body").removeClass("loading")},throwFail:function(d,e,c){alert(e);vrAdmin.Tour.enableForm()},removeTour:function(c){b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxRemoveTour",id:c.id}}).done(function(e,f,d){if(e.status==true){b("#vtour-"+e.data.id).fadeOut("slow")}else{alert("Something wrong")}})},saveHotspot:function(d){var c=document.getElementById("editTourHotspots").contentWindow;if(!c.rdy4save()){alert("Please finish to add hotspot before saving or click cancel");return false}b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxSaveHotspot",id:d.sceneId,hotspotList:JSON.stringify(c.superHotspot.getData().hotspotList),defaultViewList:JSON.stringify(c.defaultViewList)},async:true,cache:false}).done(function(f,g,e){if(f.status===true){vrAdmin.Log.appendArray(f.messages);vrAdmin.Log.append("Page reloading ...");setTimeout(window.location.replace("index.php"),2000)}else{vrAdmin.Log.appendArray(f.messages)}})},generateAlias:function(){b("body").on("blur","input[name=alias]",function(){var c=b(this).val();c=c.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"");b(this).val(c)})},hooks:function(){vrAdmin.Tour.generateAlias();b("body").on("submit","#createTour",function(c){vrAdmin.Log.reset();vrAdmin.Validate.validate();if(vrAdmin.Validate.errors.length<=0){var d=new FormData(this);b.ajax({url:"index.php",type:"POST",data:d,async:true,cache:false,contentType:false,processData:false,beforeSend:function(e){vrAdmin.Tour.disableForm()}}).done(function(g,h,f){if(g.status===true){vrAdmin.Log.appendArray(g.messages);var e=g.data.tour;e.view="tour";e.task="ajaxCreateTour";e.step="createTour";if(typeof g.data.id!=="undefined"){e.id=g.data.id}b.ajax({url:"index.php",type:"POST",data:e,async:true,cache:false}).done(function(j,k,i){if(j.status===true){vrAdmin.Log.appendArray(j.messages);vrAdmin.Log.append("Generating vr360");b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGenerateTour",id:j.data.id},async:true,cache:false}).done(function(m,n,l){if(m.status===true){vrAdmin.Log.appendArray(m.messages);vrAdmin.Log.append("Page reloading ...");setTimeout(window.location.replace("index.php"),2000)}else{vrAdmin.Log.appendArray(m.messages)}}).always(function(m,n,l){if(n=="timeout"){vrAdmin.Tour.throwFail(m,n,l)}vrAdmin.Tour.enableForm()}).fail(function(m,n,l){vrAdmin.Tour.throwFail(m,n,l)})}else{vrAdmin.Log.appendArray(j.messages);vrAdmin.Tour.enableForm()}}).fail(function(j,k,i){vrAdmin.Tour.throwFail(j,k,i)})}else{vrAdmin.Log.appendArray(g.messages);vrAdmin.Tour.enableForm()}}).fail(function(f,g,e){vrAdmin.Tour.throwFail(f,g,e)})}else{console.log(vrAdmin.Validate.errors);alert("File validate failed")}c.preventDefault()});b("body").on("click",".removeTour",function(c){if(confirm("Confirm delete a tour")){var d=b(this).parent().parent().data();vrAdmin.Tour.removeTour(d.tour);c.preventDefault()}});b("body").on("click","#saveHotspots",function(c){vrAdmin.Tour.saveHotspot(b(this).data())})}}})(window,jQuery.noConflict());