(function(b,e){var f={addTour:function(){e.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false,beforeSend:function(){e("body").addClass("loading")}}).done(function(h,i,g){if(h.status){e("body").removeClass("loading");e("#vrTour .modal-title").html('<i class="fa fa-plus-square" aria-hidden="true"></i> New tour');e("#vrTour .modal-body .container-fluid").html(h.data.html);e("#vrTour").modal("show");e(".addPano").click()}});e("#vrTour").modal("show")},editTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false}).done(function(j,k,i){if(j.status){e("#vrTour .modal-title").html('<i class="fa fa-plus-square" aria-hidden="true"></i> Edit tour');e("#vrTour .modal-body .container-fluid").html(j.data.html);e("#vrTour").modal("show");e(".addPano").click()}});e("#vrTour").modal("show")},editTourHotspot:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetHotspotEditorHtml"},async:true,cache:false}).done(function(j,k,i){if(j.status){e("#vrTour .modal-title").html('<i class="fa fa-plus-square" aria-hidden="true"></i> Add hotspot <br/>');e("#vrTour .modal-body .container-fluid").html(j.data.html);e("#vrTour").modal("show")}});e("#vrTour").modal("show")},embedTour:function(i){var g=e(i).attr("data-tour-alias");var h='<iframe width="800px" height="400px" src="http://'+document.location.hostname+"/"+g+'" ></iframe>';e("#vrTour .modal-title").html('<i class="fa fa-plus-square" aria-hidden="true"></i> Embed code');e("#vrTour .modal-body .container-fluid").text(h);e("#vrTour").modal("show")},deleteTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxDeleteTour"},async:true,cache:false}).done(function(j,k,i){if(j.status==true){e("table#vTours tr#vtour-"+h).remove()}})},hooks:function(){e("body").on("click",".addNew",function(){f.addTour()});e("body").on("click",".editTour",function(){f.editTour(this)});e("body").on("click",".editTourHotspot",function(){f.editTourHotspot(this)});e("body").on("click",".embedCode",function(){f.embedTour(this)});e("body").on("click","button.removeTour",function(g){g.preventDefault();if(confirm("Confirm delete a tour")){f.deleteTour(this)}});e("body").on("click","button.btn-log-close",function(g){g.preventDefault();f.Log.reset();e("body").removeClass("loading")});c.hooks()}};var c={generateAlias:function(){var g=e("#form-tour input#name").val();g=g.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");e("#form-tour input#alias").val(g)},hooks:function(){d.hooks();a.hooks();e("body").on("blur","#form-tour input#name",function(){c.generateAlias()});e("body").on("submit","form#form-tour",function(g){g.preventDefault();var h=new FormData(this);e.ajax({url:"index.php",type:"POST",data:h,async:true,cache:false,processData:false,contentType:false,beforeSend:function(){e("body").addClass("loading")}}).done(function(j,k,i){f.Log.appendArray(j.messages)})})}};var d={addNew:function(){var g=e(".hidden .scene").parent().html();e("#scenes .alert").remove();e("#scenes").append(g);e.validate({modules:"file"})},makeDefault:function(g){e("#form-tour input[type='checkbox'][name='sceneDefault']:checked").prop("checked",false);e(g).prop("checked",true)},remove:function(g){e(g).parent().parent().parent().parent().remove()},hooks:function(){e("body").on("click","button#addScene",function(){d.addNew()});e("body").on("click","#form-tour button.removeScene",function(h){var g=h.target||h.currentTarget;d.remove(g)});e("body").on("change","#form-tour input[type='checkbox'][name='sceneDefault']",function(h){var g=h.target||h.currentTarget;d.makeDefault(g)})}};var a={saveHotspot:function(g){var i=e(g).data("tour-id");var h=document.getElementById("editTourHotspots").contentWindow;if(!h.isReady()){alert("Please finish to add hotspot before saving or click cancel");return false}e.ajax({url:"index.php",type:"POST",data:{view:"hotspot",task:"ajaxSaveHotspot",id:i,hotspotList:JSON.stringify(h.superHotspot.getData().hotspotList),defaultViewList:JSON.stringify(h.defaultViewList)},async:true,cache:false,beforeSend:function(){e("body").addClass("loading")}}).done(function(k,l,j){f.Log.appendArray(k.messages)})},hooks:function(){e("body").on("click","button#saveHotspots",function(g){g.preventDefault();f.Tour.Hotspot.saveHotspot(this)})}};f.Tour=c;f.Tour.Scene=d;f.Tour.Hotspot=a;b.vrAdmin=f;e(document).ready(function(){b.vrAdmin.hooks()})})(window,jQuery);