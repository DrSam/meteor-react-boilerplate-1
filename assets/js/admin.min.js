!function(o,a){var e={};e.Tour={disableForm:function(){a("form input").prop("disabled",!0),a("form button").prop("disabled",!0),a("body").addClass("loading")},enableForm:function(){a("form input").prop("disabled",!1),a("form button").prop("disabled",!1),a("body").removeClass("loading")},throwFail:function(o,a,t){alert(a),e.Tour.enableForm()},removeTour:function(o){a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxRemoveTour",id:o.id}}).done(function(o,e,t){1==o.status?a("#vtour-"+o.data.id).fadeOut("slow"):alert("Something wrong")})},saveHotspot:function(o){var t=document.getElementById("editTourHotspots").contentWindow;if(!t.rdy4save())return alert("Please finish to add hotspot before saving or click cancel"),!1;a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxSaveHotspot",id:o.sceneId,hotspotList:JSON.stringify(t.superHotspot.getData().hotspotList),defaultViewList:JSON.stringify(t.superHotspot.defaultViewList)},async:!0,cache:!1}).done(function(o,a,t){!0===o.status?(e.Log.appendArray(o.messages),e.Log.append("Page reloading ..."),setTimeout(location.reload(),2e3)):e.Log.appendArray(o.messages)})},hooks:function(){a("body").on("submit","#createTour",function(o){e.Log.reset(),validate=e.Validate.validate();var t=new FormData(this);a.ajax({url:"index.php",type:"POST",data:t,async:!0,cache:!1,contentType:!1,processData:!1,beforeSend:function(o){e.Tour.disableForm()}}).done(function(o,t,n){if(!0===o.status){e.Log.appendArray(o.messages);var r=o.data.tour;r.view="tour",r.task="ajaxCreateTour",r.step="createTour",void 0!==o.data.id&&(r.id=o.data.id),a.ajax({url:"index.php",type:"POST",data:r,async:!0,cache:!1}).done(function(o,t,n){!0===o.status?(e.Log.appendArray(o.messages),e.Log.append("Generating vr360"),a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGenerateTour",id:o.data.id},async:!0,cache:!1}).done(function(o,a,t){!0===o.status?(e.Log.appendArray(o.messages),e.Log.append("Page reloading ..."),setTimeout(location.reload(),2e3)):e.Log.appendArray(o.messages)}).always(function(o,a,t){"timeout"==a&&e.Tour.throwFail(o,a,t),e.Tour.enableForm()}).fail(function(o,a,t){e.Tour.throwFail(o,a,t)})):(e.Log.appendArray(o.messages),e.Tour.enableForm())}).fail(function(o,a,t){e.Tour.throwFail(o,a,t)})}else e.Log.appendArray(o.messages),e.Tour.enableForm()}).fail(function(o,a,t){e.Tour.throwFail(o,a,t)}),o.preventDefault()}),a("body").on("click",".removeTour",function(o){if(confirm("Confirm delete a tour")){var t=a(this).parent().parent().data();e.Tour.removeTour(t.tour),o.preventDefault()}}),a("body").on("click","#saveHotspots",function(o){e.Tour.saveHotspot(a(this).data())})}},e.Panos={},e.Pano={hooks:function(){a("body").on("click","#addPano",function(){var o=a(".hidden .pano").parent().html();a("#tour-panos").append(o)}),a("body").on("click",".removePano",function(o){a(this).parent().parent().remove()})}},o.vrAdmin=e,a(document).ready(function(){e.Tours.hooks(),e.Tour.hooks(),e.Pano.hooks(),a("input").tooltip()})}(window,jQuery);
