!function(o,a){var t={};t.Controls={addNew:function(){a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGetTourHtml"},async:!0,cache:!1}).done(function(o,t,e){o.status&&(a("#vrTour .modal-body .container-fluid").html(o.data.html),a("#vrTour").modal("show"))}),a("#vrTour").modal("show")},hooks:function(){a(".addNew").on("click",function(){t.Controls.addNew()})}},t.Tours={showEmbed:function(o){a(o).find(".embedCode").on("click",function(o){a("#vrModal .modal-body").text(template),a("#vrModal").modal("show")})},showEdit:function(o){var t=a(o).data();a(o).find(".editTour").on("click",function(o){a.ajax({url:"index.php",type:"POST",data:{id:t.tour.id,view:"tour",task:"ajaxGetTourHtml"},async:!0,cache:!1}).done(function(o,t,e){o.status&&(a("#vrTour .modal-body .container-fluid").html(o.data.html),a("#vrTour").modal("show"))})})},showEditHotspot:function(o){var t=a(o).data();a(o).find(".editTourHotspot").on("click",function(o){a.ajax({url:"index.php",type:"POST",data:{id:t.tour.id,view:"tour",task:"ajaxGetHotspotEditorHtml"},async:!0,cache:!1}).done(function(o,t,e){o.status&&(a("#vrTour .modal-body .container-fluid").html(o.data.html),a("#vrTour").modal("show"))})})},showPreview:function(o){var t=a(o).data();a(o).find(".previewTour").on("click",function(o){window.open("./"+t.tour.alias,"_blank")})},hooks:function(){a("#vTours tbody tr").each(function(){t.Tours.showEmbed(this),t.Tours.showEdit(this),t.Tours.showEditHotspot(this),t.Tours.showPreview(this)})}},t.Tour={validate:function(){return t.Log.append("File validating"),a("#tour-panos input[type=file]").each(function(){var o=this.files[0];if("image/jpeg"!=o.type&&"image/png"!=o.type)return"File format is not valid";return o.size>=26214400||o.size<=5242880?"File size is not valid":void 0}),""},disableForm:function(){a("form input").prop("disabled",!0),a("form button").prop("disabled",!0),a("body").addClass("loading")},enableForm:function(){a("form input").prop("disabled",!1),a("form button").prop("disabled",!1),a("body").removeClass("loading")},throwFail:function(o,a,e){alert(a),t.Tour.enableForm()},removeTour:function(o){a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxRemoveTour",id:o.id}}).done(function(o,t,e){1==o.status?a("#vtour-"+o.data.id).fadeOut("slow"):alert("Something wrong")})},saveHotspot:function(o){var e=document.getElementById("editTourHotspots").contentWindow;if(!e.rdy4save())return alert("Please finish to add hotspot before saving or click cancel"),!1;a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxSaveHotspot",id:o.sceneId,hotspotList:JSON.stringify(e.superHotspot.getData().hotspotList)},async:!0,cache:!1}).done(function(o,a,e){!0===o.status?(t.Log.appendArray(o.messages),t.Log.append("Page reloading ..."),setTimeout(location.reload(),2e3)):t.Log.appendArray(o.messages)})},hooks:function(){a("body").on("submit","#createTour",function(o){t.Log.reset(),validate=t.Tour.validate();var e=new FormData(this);a.ajax({url:"index.php",type:"POST",data:e,async:!0,cache:!1,contentType:!1,processData:!1,beforeSend:function(o){t.Tour.disableForm()}}).done(function(o,e,n){if(!0===o.status){t.Log.appendArray(o.messages);var r=o.data.tour;r.view="tour",r.task="ajaxCreateTour",r.step="createTour",void 0!==o.data.id&&(r.id=o.data.id),a.ajax({url:"index.php",type:"POST",data:r,async:!0,cache:!1}).done(function(o,e,n){!0===o.status?(t.Log.appendArray(o.messages),t.Log.append("Generating vr360"),a.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGenerateTour",id:o.data.id},async:!0,cache:!1}).done(function(o,a,e){!0===o.status?(t.Log.appendArray(o.messages),t.Log.append("Page reloading ..."),setTimeout(location.reload(),2e3)):t.Log.appendArray(o.messages)}).always(function(o,a,e){"timeout"==a&&t.Tour.throwFail(o,a,e),t.Tour.enableForm()}).fail(function(o,a,e){t.Tour.throwFail(o,a,e)})):(t.Log.appendArray(o.messages),t.Tour.enableForm())}).fail(function(o,a,e){t.Tour.throwFail(o,a,e)})}else t.Log.appendArray(o.messages),t.Tour.enableForm()}).fail(function(o,a,e){t.Tour.throwFail(o,a,e)}),o.preventDefault()}),a("body").on("click",".removeTour",function(o){if(confirm("Confirm delete a tour")){var e=a(this).parent().parent().data();t.Tour.removeTour(e.tour),o.preventDefault()}}),a("body").on("click","#saveHotspots",function(o){t.Tour.saveHotspot(a(this).data())})}},t.Panos={},t.Pano={hooks:function(){a("body").on("click","#addPano",function(){var o=a(".hidden .pano").parent().html();a("#tour-panos").append(o)}),a("body").on("click",".removePano",function(o){a(this).parent().parent().remove()})}},o.vrAdmin=t,a(document).ready(function(){t.Controls.hooks(),t.Tours.hooks(),t.Tour.hooks(),t.Pano.hooks()})}(window,jQuery);
